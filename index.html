<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>cibc credit card</title>
  </head>
  <style>
    .top20percent {
      font-weight: 800;
    }
  </style>
  <body>
    <textarea id="bank-statements"></textarea>
    <div>TOP 20 TOTAL</div>
    <div id="top20total"></div>
    <div>OTHER TOTAL</div>
    <div id="other-total"></div>
    <div id="output"></div>
  </body>
  <script>
    const $bankStatments = document.getElementById('bank-statements');
    const data = $bankStatments.innerText;
    $bankStatments.addEventListener('input', (event) =>
      runTheScript(event.target.value)
    );

    function runTheScript(data) {
      const outputDiv = document.getElementById('output');
      outputDiv.innerHTML = '';
      const sortedData = data
        .split('\n')
        .filter((bill) => bill && !(bill.search(/\d+\.\d{2}$/) === -1))
        .sort((billA, billB) => findBillAmount(billA) < findBillAmount(billB));

      const numberOfTransactions = sortedData.length;
      const numbers = {
        topTwentyTotal: 0,
        otherTotal: 0,
      };

      sortedData.map((line, index) => {
        const isTopTwentyPercent = index / numberOfTransactions < 0.2;
        if (isTopTwentyPercent) {
          numbers.topTwentyTotal += findBillAmount(line);
        } else {
          numbers.otherTotal += findBillAmount(line);
        }
        const el = document.createElement('p');
        el.className = `${isTopTwentyPercent ? 'top20percent' : ''}`;
        el.innerText = line;
        outputDiv.appendChild(el);
      });

      document.getElementById('top20total').innerText = parseInt(
        numbers.topTwentyTotal
      );
      document.getElementById('other-total').innerText = parseInt(
        numbers.otherTotal
      );
    }
    function findBillAmount(bill) {
      const billInfo = bill
        .replace(',', '')
        .match(/(\w{3} \d{2} \w{3} \d{2}) (.+) (\d+\.\d{2})$/);
      return billInfo && billInfo.hasOwnProperty(3) && parseFloat(billInfo[3]);
    }
  </script>
</html>
